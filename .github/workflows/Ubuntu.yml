name: Secure Ubuntu Server - 24/7 (Ø®Ø§Ù„ÛŒ)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */5 * * *'   # Ù‡Ø± Ûµ Ø³Ø§Ø¹Øª restart Ø®ÙˆØ¯Ú©Ø§Ø±

jobs:
  ubuntu-server:
    runs-on: ubuntu-latest
    timeout-minutes: 300

    steps:
      # â”€â”€â”€â”€â”€â”€ Û±. ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† SSH Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ø§Ø±Ø¨Ø± â”€â”€â”€â”€â”€â”€
      - name: Enable SSH + Set Credentials
        shell: bash
        run: |
          sudo apt-get update -y
          sudo apt-get install -y openssh-server

          # ØªÙ†Ø¸ÛŒÙ… Ø±Ù…Ø² Ú©Ø§Ø±Ø¨Ø± runner (Ø±Ù…Ø² Ø¯Ù„Ø®ÙˆØ§Ù‡Øª Ø±Ùˆ Ø¹ÙˆØ¶ Ú©Ù†)
          echo 'runner:SecureLinux2026' | sudo chpasswd

          # Ø§Ø¬Ø§Ø²Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø±Ù…Ø²
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config
          sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config

          sudo systemctl enable ssh
          sudo systemctl start ssh
          sudo systemctl restart ssh

          echo "âœ… SSH Server ÙØ¹Ø§Ù„ Ø´Ø¯!"

      # â”€â”€â”€â”€â”€â”€ Û². Ø§ØªØµØ§Ù„ Ø¨Ù‡ Tailscale â”€â”€â”€â”€â”€â”€
      - name: Connect to Tailscale
        uses: tailscale/github-action@v4
        with:
          authkey: ${{ secrets.TS_AUTHKEY }}

      # â”€â”€â”€â”€â”€â”€ Û³. Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØªØµØ§Ù„ â”€â”€â”€â”€â”€â”€
      - name: Connection Info
        shell: bash
        run: |
          echo ""
          echo "============================================================="
          echo "             ğŸš€ Ø³Ø±ÙˆØ± Ubuntu 24.04 Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯!             "
          echo "============================================================="
          echo ""
          
          IP=$(tailscale ip -4)
          echo "ğŸŒ Tailscale IP      : $IP"
          echo "ğŸ‘¤ Username          : runner"
          echo "ğŸ”‘ Password          : SecureLinux2026"
          echo ""
          echo "ğŸ“Œ Ù†Ø­ÙˆÙ‡ Ø§ØªØµØ§Ù„:"
          echo "   ssh runner@$IP"
          echo ""
          echo "   Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:"
          echo "   â€¢ Termius (Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯/Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±)"
          echo "   â€¢ JuiceSSH (Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯)"
          echo "   â€¢ FinalShell / Tabby (Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±)"
          echo ""
          echo "âœ… Ø³Ø±ÙˆØ± Ù‡Ù…ÛŒØ´Ù‡ Ø²Ù†Ø¯Ù‡ (Ù‡Ø± Ûµ Ø³Ø§Ø¹Øª restart Ø®ÙˆØ¯Ú©Ø§Ø±)"
          echo "============================================================="

      # â”€â”€â”€â”€â”€â”€ Û´. Auto Restart â”€â”€â”€â”€â”€â”€
      - name: Auto Restart
        if: always()
        shell: bash
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        run: |
          gh workflow run "\( {{ github.workflow }}" --ref " \){{ github.ref_name }}"
          sleep 21600
