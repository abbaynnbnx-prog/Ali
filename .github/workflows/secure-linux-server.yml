name: Secure Linux Server - 24/7 (Ubuntu + Tailscale)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */5 * * *'   # Ù‡Ø± Ûµ Ø³Ø§Ø¹Øª restart Ø®ÙˆØ¯Ú©Ø§Ø±

jobs:
  linux-server:
    runs-on: ubuntu-latest
    timeout-minutes: 300

    steps:
      # â”€â”€â”€â”€â”€â”€ Û±. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Tailscale â”€â”€â”€â”€â”€â”€
      - name: Connect to Tailscale
        uses: tailscale/github-action@v4
        with:
          authkey: ${{ secrets.TS_AUTHKEY }}

      # â”€â”€â”€â”€â”€â”€ Û². ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† SSH Ø³Ø±ÙˆØ± â”€â”€â”€â”€â”€â”€
      - name: Enable SSH Server
        shell: bash
        run: |
          sudo apt-get update -y
          sudo apt-get install -y openssh-server
          
          # Ú©Ø§Ø±Ø¨Ø± runner Ø±Ùˆ ÙØ¹Ø§Ù„ Ùˆ Ø±Ù…Ø² Ø¨Ú¯Ø°Ø§Ø± (Ø±Ù…Ø² Ø¯Ù„Ø®ÙˆØ§Ù‡Øª Ø±Ùˆ Ø¹ÙˆØ¶ Ú©Ù†)
          echo 'runner:SecureLinux2026' | sudo chpasswd
          
          # Ø§Ø¬Ø§Ø²Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø±Ù…Ø²
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config
          sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config
          
          sudo systemctl enable ssh
          sudo systemctl start ssh
          sudo systemctl restart ssh

          echo "âœ… SSH Server ÙØ¹Ø§Ù„ Ø´Ø¯!" 

      # â”€â”€â”€â”€â”€â”€ Û³. Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØªØµØ§Ù„ â”€â”€â”€â”€â”€â”€
      - name: Connection Info
        shell: bash
        run: |
          echo ""
          echo "============================================================="
          echo "             ğŸš€ Ø³Ø±ÙˆØ± Ù„ÛŒÙ†ÙˆÚ©Ø³ Û²Û´ Ø³Ø§Ø¹ØªÙ‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯!             "
          echo "============================================================="
          echo ""
          
          TS_IP=$(tailscale ip -4)
          echo "ğŸŒ Tailscale IP      : $TS_IP"
          echo "ğŸ‘¤ Username          : runner"
          echo "ğŸ”‘ Password          : SecureLinux2026"   # â† Ø§ÛŒÙ†Ùˆ Ø¹ÙˆØ¶ Ú©Ø±Ø¯ÛŒØŸ
          echo ""
          echo "ğŸ“Œ Ù†Ø­ÙˆÙ‡ Ø§ØªØµØ§Ù„:"
          echo "   ssh runner@$TS_IP"
          echo ""
          echo "   ÛŒØ§ Ø¨Ø§ Ø§Ù¾ Termius / JuiceSSH / FinalShell"
          echo ""
          echo "âœ… Ø³Ø±ÙˆØ± Ù‡Ù…ÛŒØ´Ù‡ Ø²Ù†Ø¯Ù‡ (Ù‡Ø± Ûµ Ø³Ø§Ø¹Øª restart Ø®ÙˆØ¯Ú©Ø§Ø±)"
          echo "============================================================="
          echo ""

      # â”€â”€â”€â”€â”€â”€ Û´. Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† Ùˆ Auto Restart â”€â”€â”€â”€â”€â”€
      - name: Keep Alive + Auto Restart
        if: always()
        shell: bash
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        run: |
          gh workflow run "\( {{ github.workflow }}" --ref " \){{ github.ref_name }}"
          sleep 21600   # Û¶ Ø³Ø§Ø¹Øª (Ø¨Ø±Ø§ÛŒ margin)
