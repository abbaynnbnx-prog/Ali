name: Hysteria2 VPN Server - 24/7

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */5 * * *'   # Ù‡Ø± Ûµ Ø³Ø§Ø¹Øª restart Ø®ÙˆØ¯Ú©Ø§Ø±

jobs:
  hysteria2-vpn:
    runs-on: ubuntu-latest
    timeout-minutes: 300

    steps:
      # â”€â”€â”€â”€â”€â”€ Û±. Ù†ØµØ¨ Hysteria2 â”€â”€â”€â”€â”€â”€
      - name: Install Hysteria2 VPN Server
        shell: bash
        run: |
          # Ù†ØµØ¨ Hysteria2
          curl -fsSL https://get.hy2.sh/ | bash
          
          # Ø³Ø§Ø®Øª Ú©Ø§Ù†ÙÛŒÚ¯ Ø³Ø§Ø¯Ù‡ (Ø±Ù…Ø² Ùˆ Ù¾ÙˆØ±Øª Ø¯Ù„Ø®ÙˆØ§Ù‡Øª)
          cat > /etc/hysteria/config.yaml << EOF
          listen: :443
          tls:
            enabled: true
            cert: /etc/hysteria/fullchain.pem
            key: /etc/hysteria/privkey.pem
          auth:
            type: password
            password: "SecureVPN2026"   # â† Ø±Ù…Ø² VPNØª Ø±Ùˆ Ø¹ÙˆØ¶ Ú©Ù†
          masquerade:
            type: proxy
            proxy:
              protocol: http
              addr: 127.0.0.1:8080
          EOF

          # ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ùˆ Ø´Ø±ÙˆØ¹
          systemctl enable hysteria-server
          systemctl start hysteria-server

          echo "âœ… Hysteria2 Server Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯!"

      # â”€â”€â”€â”€â”€â”€ Û². Ø§ØªØµØ§Ù„ Ø¨Ù‡ Tailscale (Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¢Ø³Ø§Ù†) â”€â”€â”€â”€â”€â”€
      - name: Connect to Tailscale
        uses: tailscale/github-action@v4
        with:
          authkey: ${{ secrets.TS_AUTHKEY }}

      # â”€â”€â”€â”€â”€â”€ Û³. Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØªØµØ§Ù„ â”€â”€â”€â”€â”€â”€
      - name: VPN Connection Info
        shell: bash
        run: |
          echo ""
          echo "============================================================="
          echo "             ðŸš€ Hysteria2 VPN Server Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯!             "
          echo "============================================================="
          echo ""
          
          TS_IP=$(tailscale ip -4)
          echo "ðŸŒ Tailscale IP (Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª): $TS_IP"
          echo "ðŸ”‘ Ø±Ù…Ø² VPN               : SecureVPN2026"
          echo "ðŸ“Œ Ù¾ÙˆØ±Øª                   : 443 (QUIC)"
          echo ""
          echo "ðŸ“± Ù†Ø­ÙˆÙ‡ Ø§ØªØµØ§Ù„ Ø±ÙˆÛŒ Ú¯ÙˆØ´ÛŒ/Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±:"
          echo "   Û±. Ø§Ù¾ Hysteria2 ÛŒØ§ Nekobox / v2rayNG / Shadowrocket Ù†ØµØ¨ Ú©Ù†"
          echo "   Û². Ù¾Ø±ÙˆØªÚ©Ù„: Hysteria2"
          echo "   Û³. Ø¢Ø¯Ø±Ø³: $TS_IP:443"
          echo "   Û´. Ø±Ù…Ø²: SecureVPN2026"
          echo ""
          echo "âœ… Ø³Ø±ÙˆØ± Û²Û´ Ø³Ø§Ø¹ØªÙ‡ ÙØ¹Ø§Ù„Ù‡ (Ù‡Ø± Ûµ Ø³Ø§Ø¹Øª restart Ø®ÙˆØ¯Ú©Ø§Ø±)"
          echo "============================================================="
          echo ""

      # â”€â”€â”€â”€â”€â”€ Û´. Auto Restart â”€â”€â”€â”€â”€â”€
      - name: Keep Alive + Auto Restart
        if: always()
        shell: bash
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        run: |
          gh workflow run "\( {{ github.workflow }}" --ref " \){{ github.ref_name }}"
          sleep 21600
